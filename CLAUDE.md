# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Docusaurus-based technical blog hosted at https://blog.cloudea.org. The site is automatically deployed via Vercel on every commit.

**Key characteristics:**
- Russian-language blog about development, self-hosting, and automation
- Blog posts serve as the main content at route `/` (not `/blog`)
- Documentation/wiki section at route `/docs`
- Strict link validation: broken links or anchors will fail the build

## Common Commands

```bash
# Development
npm start                    # Start local dev server (usually http://localhost:3000)
npm run build                # Production build (fails on broken links/anchors)
npm run serve                # Preview production build locally
npm run clear                # Clear Docusaurus cache

# Other
npm run swizzle              # Customize Docusaurus components
npm run write-translations   # Generate translation files
npm run write-heading-ids    # Auto-generate heading IDs
```

## Project Structure

```
blog/                          # Blog posts (main content)
├── 2024/, 2025/              # Posts organized by year
├── archive/                  # Archived posts
├── authors.yml               # Author definitions
└── tags.yml                  # Tag definitions with descriptions

docs/                          # Documentation/wiki section
├── bots/                     # Bot-related docs
├── garrysmod/                # Garry's Mod docs
├── minecraft/                # Minecraft docs
├── javascript/               # JavaScript tutorials
├── windows/                  # Windows guides
└── other/                    # Other topics

src/
├── components/               # Custom React components
│   └── geocheck.js          # GeoCheck: region-based content blocking using ipinfo.io
├── css/                      # Custom stylesheets (custom.css, layout.css, overrides.css)
├── theme/                    # Swizzled Docusaurus components
│   ├── BlogPostItem/        # Adds SEO structured data (JSON-LD) to blog posts
│   └── DocItem/Layout/      # Adds SEO structured data (JSON-LD) to docs
└── pages/                    # Custom pages (e.g., about.md)

static/                        # Static assets
└── img/                      # Images, logos, og-default.png

docusaurus.config.js          # Main Docusaurus configuration
sidebars.js                   # Sidebar config (autogenerated from docs structure)
```

## Content Architecture

**Blog Posts:**
- Organized by year: `blog/2024/`, `blog/2025/`
- Formats: `.md` or `.mdx` (MDX allows React components in markdown)
- Post folders can contain an `index.md` + assets
- Required frontmatter: `title`, `description`, `tags`, `keywords`, `image`
- Tags reference `blog/tags.yml` for permalinks and descriptions
- Authors reference `blog/authors.yml`

**Example blog post frontmatter:**
```yaml
---
title: "Post Title"
description: "Post description for SEO"
tags: [telegram, proxy, linux, self-hosting]
keywords: [mtproxy, telegram, vps, self-hosting]
image: /img/og-default.png
---
```

**Documentation:**
- Auto-generated sidebar from `docs/` folder structure
- Frontmatter: `title`, `description`, `keywords` (optional)
- Supports breadcrumbs and last update time

## Custom Components & Features

### GeoCheck Component (`src/components/geocheck.js`)
Region-based content visibility control using ipinfo.io API.

**Usage in MDX:**
```jsx
import GeoCheck from '/src/components/geocheck';

<GeoCheck region="RU">
  Content visible only in Russia
</GeoCheck>
```

**Props:**
- `region`: country code (e.g., "RU")
- `blockMessage`: custom error message
- `fallback`: loading state component
- `onCheck`: custom check function `(userCountry, region) => boolean`

### SEO Structured Data
The theme components automatically inject JSON-LD structured data:
- **BlogPostItem** (`src/theme/BlogPostItem/index.tsx`): Adds `BlogPosting` and `BreadcrumbList` schemas only on individual post pages
- **DocItem Layout** (`src/theme/DocItem/Layout/index.tsx`): Adds `Article` and `BreadcrumbList` schemas to documentation

This enhances search engine visibility and rich snippets.

## Configuration

**docusaurus.config.js** contains:
- Site metadata (title, tagline, URL)
- Theme configuration (navbar, prism, custom CSS)
- Plugin setup:
  - Yandex Metrica (counter ID: 101940986)
  - Google Analytics (GTM-MBTPCD7S)
  - Algolia Search
  - Backlinks plugin (`@koroligor/docusaurus-plugin-backlinks`)
  - Ideal Image plugin (image optimization)
- i18n: default locale `ru`, with `en` support
- SEO: JSON-LD structured data for the site, preconnect hints, theme colors

**Important settings:**
- `onBrokenLinks: 'throw'` - build fails on broken links
- `onBrokenMarkdownLinks: 'throw'` - build fails on broken markdown links
- `routeBasePath: '/'` for blog (not `/blog`)
- `routeBasePath: '/docs'` for documentation

## Development Guidelines

**When creating/editing blog posts:**
1. Place posts in `blog/YYYY/` folder (or `blog/YYYY/post-slug/` for posts with assets)
2. Use `.mdx` if you need React components (e.g., GeoCheck)
3. Include all required frontmatter fields
4. Ensure `tags` exist in `blog/tags.yml`
5. Verify all internal links and anchors are correct (build will fail otherwise)
6. Use `/img/...` for images in `static/img/`
7. Add author reference if not using default `bazzzilius`

**When editing documentation:**
1. Place files in appropriate `docs/` subdirectory
2. Sidebar is auto-generated from folder structure
3. Include frontmatter for SEO (`description`, `keywords`)
4. Verify cross-references between docs

**When editing theme components:**
- Components in `src/theme/` are swizzled from Docusaurus
- Preserve TypeScript types and React patterns
- SEO structured data should always include canonical URLs (`https://blog.cloudea.org${metadata.permalink}`)
- Test both blog and docs pages after changes

**Link validation:**
- Always verify anchor links (e.g., `#section-heading`) match actual heading IDs
- Use lowercase and hyphens for heading anchors
- Test build locally before pushing: `npm run build`

## Deployment

Deployment is automatic via Vercel:
1. Push to `main` branch
2. Vercel builds with `npm run build`
3. Site deploys to https://blog.cloudea.org
4. Cloudflare handles DNS (CNAME to Vercel domain)

Build failures (broken links, compilation errors) prevent deployment.
